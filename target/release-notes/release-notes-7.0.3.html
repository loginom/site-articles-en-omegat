Исправлены ошибки в нескольких Подключениях к источникам данных, в визуализаторах, в компонентах Калькулятор, Конечные классы, Дата и время, а также в компонентах, входящих в группы Импорт, Дерево данных, Программирование и Экспорт. Изменились системные требования для Loginom под Linux. Installer was improved.

<h2 id="исправление-ошибок">Fixes</h2>

<p><a href="https://help.loginom.ru/userguide/processors/programming/java-script/" target="_blank"><strong>JavaScript:</strong></a>&nbsp;Исправлена ошибка "Runtime is in exception state", которая возникала при одновременной остановке выполнения скрипта и возникновении ошибки в скрипте. Чаще всего ошибка возникала в&nbsp;<em>Предпросмотре</em>&nbsp;узла&nbsp;<em>JavaScript</em>, т.к. в этом случае обрабатываются только первые 100 строк набора данных и скрипт останавливается (#9876).</p>

<p><a href="https://help.loginom.ru/adminguide/integrator/" target="_blank"><strong>Loginom Intergator:</strong></a>&nbsp;В OpenAPI устранена генерация&nbsp;<code>"nullable": true</code>&nbsp;для свойств, которые не должны принимать значение null:</p>

<ul>
	<li>для свойств, соответствующих портам узла;</li>
	<li>для свойства Rows в наборе данных;</li>
	<li>для контейнеров в древовидной структуре данных.</li>
</ul>

<p>В ответное json-сообщение Интегратора не записываются опциональные элементы, у которых не задано значение. В частности, в это сообщение теперь не записываются элементы вида&nbsp;<code>"Container": null</code>&nbsp;для отсутствующих контейнеров в древовидной структуре данных (#9793).</p>

<p><a href="https://help.loginom.ru/userguide/processors/programming/python/" target="_blank"><strong>Python:</strong></a>&nbsp;Исправлена ошибка "Не удалось запустить /usr/bin/python", которая возникала в Loginom под Linux, установленном в докер-контейнер на AstraLinux SE (#9843).</p>

<p><a href="https://help.loginom.ru/userguide/processors/integration/soap-request.html" target="_blank"><strong>SOAP-запрос:</strong></a>&nbsp;В узле SOAP-запрос исправлено дублирование заголовка Content-Length в запросе. В ответ на такой запрос можно было получить ошибку "Bad Request" (#9850).</p>

<p><strong>SOAP-запрос:</strong>&nbsp;Исправлена ошибка "Не выбрана операция WSDL", которая возникала при перенастройке узла SOAP-запроса на другую операцию с тем же именем, но внутри другой службы или порта. Например, если опубликовано два пакета, в которых есть опубликованная подмодель с одним и тем же именем, а узел SOAP-запрос первоначально настроенный на операцию службы из первого пакета, перенастраивается на ту же самую операцию из второго пакета. При этом подключение, которое использует узел SOAP-запрос, настроено на корневой WSDL документ Loginom Integrator&nbsp;<code>/soap?wsdl</code>&nbsp;(#9855).</p>

<p><a href="https://help.loginom.ru/userguide/visualization/preview/quick-view.html" target="_blank"><strong>Быстрый просмотр:</strong></a>&nbsp;При работе в Google Chrome в&nbsp;<em>Быстром просмотре</em>&nbsp;узла с большим объемом данных (например, если в наборе есть очень длинные строки (более 5 млн. символов)) возникала ошибка браузера "Aw, Snap! Something went wrong while displaying this webpage.". В некоторых случаях после просмотра данных ошибка не появлялась, но наблюдалось значительное замедление работы Loginom Studio и требовался перезапуск браузера. The problem was solved. Теперь длина строки для быстрого просмотра ограничена 5000 символов, чтобы браузер мог отобразить данные (#5776, #6166).</p>

<p><a href="https://help.loginom.ru/userguide/visualization/data-quality/" target="_blank"><strong>Визуализатор Качество данных:</strong></a>&nbsp;Исправлена ошибка "Cannot read properties of null (reading 'Calculated')", которая возникала, если настроить визуализатор на узле с большим набором данных, запустить расчет статистик, перейти в соседней вкладке в сценарий и удалить узел, на котором настроен визуализатор (#9810).</p>

<p><a href="https://help.loginom.ru/userguide/visualization/cube/" target="_blank"><strong>Визуализатор Куб:</strong></a>&nbsp;При выгрузке кросс-таблицы&nbsp;<em>Куба</em>&nbsp;в Exсel единицы измерения на кириллице, установленные через окно&nbsp;<em>Форматирование</em>&nbsp;в редакторе свойств&nbsp;<em>Денежный знак</em>, отображались в неверной кодировке. The regression error was corrected (#9860).</p>

<p><strong>Визуализатор Куб:</strong>&nbsp;Если в&nbsp;<em>Кубе</em>&nbsp;открыть детализацию и быстро перемещаться по ячейкам кросс-таблицы&nbsp;<em>Куба</em>, то иногда детализация не соответствовала выделенной ячейке. Такая проблема могла наблюдаться и в других визуализаторах с детализацией. Error of behavior was corrected (#9803).</p>

<p><strong>Визуализатор Куб:</strong>&nbsp;Исправлена ошибка "Cannot read properties of undefined (reading 'DimensionType')", которая иногда возникала в пакетах, подготовленных в 6-ой версии Loginom, при настройке измерений через окно&nbsp;<em>Настроить измерения</em>&nbsp;(#9904).</p>

<p><strong>Визуализатор Куб:</strong>&nbsp;Исправлена ошибка "Could not convert variant of type (UnicodeString) into type (Integer)", которая возникала в&nbsp;<em>Кубе</em>&nbsp;с измерением переменного типа при попытке вставить произвольное значение в строку поиска через Ctrl+V или кнопку на панели инструментов.</p>

<p><a href="https://help.loginom.ru/userguide/visualization/statistics/" target="_blank"><strong>Визуализатор Статистика:</strong></a>&nbsp;Исправлен граничный случай непопадания требуемой точки в гистограмму при расчете квантилей. Из-за ошибки на некоторых наборах данных визуализатор не отображался (#9839).</p>

<p><a href="https://help.loginom.ru/userguide/processors/transformation/trans-datatime/" target="_blank"><strong>Дата и время:</strong></a>&nbsp;В пакетах, подготовленных в 6-ой версии с настроенным компонентом Дата/время, который выделяет из даты месяц в строковом формате (%F), после открытия в Logimon 7 название месяца формировалось в родительном падеже. The regression error was corrected. Узел "Дата и время" формирует строку месяца в именительном падеже. Для задания полного имени месяца в родительном падеже добавили маркер формата %P (#9925).</p>

<p><a href="https://help.loginom.ru/userguide/processors/data-trees/tree-to-table.html" target="_blank"><strong>Дерево в таблицу:</strong></a>&nbsp;В портах типа&nbsp;<em>Дерево</em>&nbsp;после закрытия и повторного открытия пакета пропадали узлы-контейнеры, содержащие используемые узлы. Проблема наблюдалась при включенной автосинхронизации. Error of behavior was corrected (#7509).</p>

<p><strong>Дерево в таблицу:</strong>&nbsp;У узла&nbsp;<em>Дерево в таблицу</em>, находящегося внутри&nbsp;<em>Подмодели</em>&nbsp;с включенной автосинхронизацией на входном порту, сбрасывались настройки после закрытия и повторного открытия пакета. The situation was rectified (#9076).</p>

<p><a href="https://help.loginom.ru/userguide/integration/import/excel/" target="_blank"><strong>Импорт Excel:</strong></a>&nbsp;При указании явно заданного диапазона для файла, содержащего одинаковые столбцы, на второй странице мастера настройки возникала ошибка "Invalid row/column index". Аналогичная ошибка возникала для любого набор данных при указании явно заданного диапазона, охватывающего все строки или все колонки (например, A:B - все строки из колонок A и B). The error was corrected (#9883, #5734).</p>

<p><a href="https://help.loginom.ru/userguide/integration/import/ldf.html" target="_blank"><strong>Импорт из LGD-файла:</strong></a>&nbsp;Исправлена ошибка Access violation at address, которая возникала при изменении типа данных используемого столбца в импортируемом файле. Такая ситуация возможна, например, если есть Файл 1 и Файл 2, отличающиеся только типом данных одного из столбцов, и импорт данных первоначально настроен на Файл 1, затем Файл 1 удален, а Файл 2 переименован в Файл 1 (#6990).</p>

<p><a href="https://help.loginom.ru/userguide/integration/import/database.html" target="_blank"><strong>Импорт из базы данных:</strong></a>&nbsp;Исправлена ошибка "Клиентский прокси-объект финализирован", которая возникала после нажатии кнопки "Сохранить" в мастере настройки импорта из базы данных, если при настройке таблица для импорта выбрана через пустую переменную (#9745).</p>

<p><a href="https://help.loginom.ru/userguide/processors/transformation/calc/" target="_blank"><strong>Калькулятор:</strong></a>&nbsp;Если в мастере настройки узла открыть на редактирование выражение, изменить несколько его свойств, а затем, пока выражение находится в режиме редактирования, переместить его вверх или вниз, то изменения, выполненные до перемещения, не сохранялись. Error of behavior was corrected (#8306).</p>

<p><strong>Калькулятор:</strong>&nbsp;Функции ArcSin и ArcCos выдавали неверный результат. ArcSin(0)=1,57 instead of 0, ArcCos(0)=0 instead of 1,57. The error appeared in version 7.0.0. Corrections were introduced (#9862).</p>

<p><strong>Калькулятор:</strong>&nbsp;В мастере настройки узла актуализировали описание функции StrToDate. Внесены изменения в пример:</p>

<ul>
	<li>формат с&nbsp;<code>DD/MM/YY/HH:NN:SS</code>&nbsp;заменен на&nbsp;<code>DD/MM/YY HH:NN:SS</code>,</li>
	<li>строка даты/времени с&nbsp;<code>25/12/04/12:44:54</code>&nbsp;на&nbsp;<code>25/12/04 12:44:54</code>.</li>
</ul>

<p><a href="https://help.loginom.ru/userguide/processors/preprocessing/coarse-classes.html" target="_blank"><strong>Конечные классы:</strong></a>&nbsp;Если в качестве входного поля выбрать поле типа Дата/Время, то в мастере настройки узла&nbsp;<em>Конченые классы</em>&nbsp;отображались вещественные значения Даты/Время, хотя в порту&nbsp;<em>Параметры классов</em>, значения были правильными. The error was corrected (#7612).</p>

<p><strong>Конечные классы:</strong>&nbsp;Исправлена ошибка Access violation at address. Ошибка возникала при некоторых действиях пользователя по редактированию разбиения во время клика на ячейку границы (#8666).</p>

<p><strong>Конечные классы:</strong>&nbsp;В таблице конечных классов нижняя граница класса отличалась от верхней границы предыдущего класса. Если в окне интерактивного визуализатора мастера настройки узла отредактировать верхнюю границу первого класса, а затем изменить верхнюю границу последующего класса, то после нажатия клавиши Enter изменялась и нижняя граница второго класса. В этой ситуации нижняя граница второго класса не должна изменяться и должна совпадать с верхней границей предыдущего класса. The error was corrected (#8679).</p>

<p><a href="https://help.loginom.ru/userguide/integration/connections/list/clickhouse.html" target="_blank"><strong>Подключение ClickHouse:</strong></a>&nbsp;Устранили утечку памяти. Добавили поддержку NULL-значений для парамеров в параметризированных SELECT-запросах.</p>

<p><a href="https://help.loginom.ru/userguide/integration/connections/list/postgresql.html" target="_blank"><strong>Подключение PostgreSQL:</strong></a>&nbsp;В мастере настройки&nbsp;<em>Импорта из Базы данных</em>&nbsp;не отображались материализованные представления (Materialized View), cекционированные таблицы (Table Partitioning) и внешние таблицы (Foreign Data). The situation was rectified (#9898).</p>

<p><strong>Подключение PostgreSQL:</strong>&nbsp;Для сервера PostgreSQL, у которого конфигурационный параметр lc_messages = 'Russian_Russia.1251', сообщения об ошибках на кириллице выводились в неверной кодировке. The error was corrected (#9933).</p>

<p><a href="https://help.loginom.ru/userguide/integration/connections/list/soap-service.html" target="_blank"><strong>Подключение SOAP-сервис:</strong></a>&nbsp;Если при настройке подключения в поле Источник WSDL указать путь к файлу, в котором namespace префикс, используемый в схеме, объявлен в элементе&nbsp;<code>wsdl:definitions</code>, то при тестировании подключения возникала ошибка загрузки WSDL "Ошибка libxml2 (код 3004): Element '{<a href="http://www.w3.org/2001/XMLSchema%7Delement" target="_blank">http://www.w3.org/2001/XMLSchema}element</a>', attribute 'type': References from this schema to components in no namespace are not allowed, since not indicated by an import statement." Ошибку исправили (#9844).</p>

<p><strong>Подключение SOAP-сервис:</strong>&nbsp;При настройке узла SOAP-запрос на странице&nbsp;<em>Выбор метода запроса</em>&nbsp;отсутствовали элементы, соответствующие опубликованному пакету, если использовалось подключение к SOAP-сервису, в котором источником WSDL являлся корневой WSDL документ Loginom Integrator&nbsp;<code>/soap?wsdl</code>. Error of behavior was corrected (#9851).</p>

<p><strong>Подключение SOAP-сервис:</strong>&nbsp;Исправлена ошибка Access violation at address при подключении к SOAP-сервису, если схема содержит ComplexType с mixed содержимым (#9864).</p>

<p><a href="https://help.loginom.ru/userguide/integration/connections/list/schemes.html" target="_blank"><strong>Подключение Набор XSD-схем:</strong></a>&nbsp;Исправили ошибку в обработке конструкции simpleContent extension, из-за которой у корневого элемента отсутствовали дочерние элементы (#9868).</p>

<p><strong>Приложение:</strong>&nbsp;Исправлена ошибка "Менеджер переменных для типа IDOMNode не зарегистрирован", которая возникала при открытии некоторых пакетов, созданных в версиях младше 6.1.4 (#9837).</p>

<p><a href="https://help.loginom.ru/userguide/processors/data-trees/table-to-tree.html" target="_blank"><strong>Таблица в дерево:</strong></a>&nbsp;В выходном порту узла&nbsp;<em>Таблица в дерево</em>&nbsp;отсутствовали некоторые узлы при наличии вложенных массивов. The error was corrected (#9887).</p>

<p><a href="https://help.loginom.ru/userguide/location_user_files.html" target="_blank"><strong>Файловое хранилище:</strong></a>&nbsp;При открытии пакета из папки с правами только на чтение возникала ошибка и пакет не открывался. It is a regression error. Внесли исправления, теперь пакет открывается без права на сохранение изменений, а пользователь получает соответствующее уведомление (#9861).</p>

<p><a href="https://help.loginom.ru/userguide/integration/export/txt-csv.html" target="_blank"><strong>Экспорт в текстовый файл:</strong></a>&nbsp;Многострочные значения (строковые значения, содержащие символы переноса строк) экспортировались без обрамляющих кавычек. В результате строковое значение разбивалось на разные строки без какой-либо информации о том, что оно должно быть одной строкой. При последующем импорте структура файла могла быть нарушена, данные считывались не как одна строка, а разбивались на несколько значений. The export error was corrected (#9683).</p>

<p><strong>Экспорт в текстовый файл:</strong>&nbsp;При экспорте строк с не-ASCII-символами в файл с фиксированной шириной столбцов, ширина столбцов в полученном файле не была одинаковой. The error was corrected (#9905).</p>

<p><strong>Экспорт в текстовый файл:</strong>&nbsp;Символы, которые не поддерживаются кодировкой экспортируемого текстового файла, в Loginom под Windows заменялись символом с кодом&nbsp;<code>0x3F</code>, а в Loginom под Linux —&nbsp;<code>0x1A</code>. Привели к единообразию, теперь в обеих системах неподдерживаемые символы будут заменены на&nbsp;<code>0x1A</code>&nbsp;(#9920).</p>

<h2 id="улучшения">Improvements</h2>

<p><strong>Loginom Server:</strong>&nbsp;Для определения IP адреса клиента, подключившегося к Loginom Server по WebSocket через Proxy-сервер, используется заголовок X-Forwarded-For. Теперь в логах и в&nbsp;<a href="https://help.loginom.ru/userguide/admin/dispatcher.html" target="_blank">Диспетчере</a>&nbsp;раздела&nbsp;<a href="https://help.loginom.ru/userguide/admin/" target="_blank">Администрирование</a>&nbsp;можно увидеть всю цепочку IP адресов —&nbsp;<code>Исходный IP -&gt; IP proxy 1 -&gt; IP proxy 2</code>. Ранее IP клиента определялся как&nbsp;<code>IP proxy 2</code>&nbsp;(#9541).</p>

<p><strong>Инсталлятор:</strong>&nbsp;В интерфейсе инсталлятора под Linux появилась возможность выбрать базовый образ сервера. В параметры, принимаемые скриптом, добавлен еще один —&nbsp;<code>--from_image</code>, за которым пользователю необходимо указать желаемый базовый образ из присутствующих в&nbsp;<code>server/Dockerfile</code>. Перед построением образа сервера происходит проверка на наличие в&nbsp;<code>server/Dockerfile</code>, если образ не найден, то скрипт завершает свою работу с выводом ошибки (#9809).</p>

<p><strong>Инсталлятор:</strong>&nbsp;Файл&nbsp;<code>loginomd.socket</code>&nbsp;перенесен в папку&nbsp;<code>%ProgramData%\Loginom</code>&nbsp;из подпапки&nbsp;<code>%ProgramData%\Loginom\Server</code>&nbsp;(#6640).</p>

<p><strong>Инсталлятор:</strong>&nbsp;При установке Loginom Integrator редакций Standard и Enterprise создается ярлык на страницу «OpenAPI описание сервиса» (#9673).</p>

<p><strong>Логирование:</strong>&nbsp;Появилась возможность логирования больших сообщений из узла JavaScript при логировании в journald.</p>

<h2 id="изменения-в-системных-требованиях">Изменения в системных требованиях</h2>

<ol>
	<li>
	<p>Минимальная поддерживаемая версия ядра Linux 5.3.</p>
	</li>
	<li>
	<p>Минимальная поддерживаемая версия docker 20.10.0.</p>
	</li>
</ol>

<h2 id="прочие-изменения">Other Changes</h2>

<p><a href="https://loginom.ru/download" target="_blank"><strong>Loginom Community Edition:</strong></a>&nbsp;Некоторые пользователи Loginom CE 7-ой версии сталкиваются с "проблемой первого запуска", когда при попытке запустить приложение открывается окно, но не отображается интерфейс. При этом повторный запуск позволяет начать работу. Чтобы обойти эту проблему добавили возможность запуска Loginom CE с аргументом командной строки&nbsp;<code>--disable-cache</code>. После обновления Loginom CE необходимо открыть свойства ярлыка и в редакторе ввода "Объект" в конце строки добавить через пробел&nbsp;<code>--disable-cache</code>.</p>

<p><a href="https://help.loginom.ru/userguide/integration/connections/list/sqlite.html" target="_blank"><strong>Подключение SQLite:</strong></a>&nbsp;Импорт и экспорт для зашифрованной базы данных стал работать быстрее на 25%. Прирост производительности будет на подключениях, созданных в Loginom 7.0.3 (#8213).</p>

<p class="lg-text-btn lg-text-btn_border"><a href="https://loginom.ru/download">Try version</a></p>
